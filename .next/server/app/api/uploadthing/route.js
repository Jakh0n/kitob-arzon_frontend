(()=>{var e={};e.id=735,e.ids=[735],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},11723:e=>{"use strict";e.exports=require("querystring")},27910:e=>{"use strict";e.exports=require("stream")},83997:e=>{"use strict";e.exports=require("tty")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},51406:(e,t,r)=>{"use strict";let s;r.r(t),r.d(t,{patchFetch:()=>sa,routeModule:()=>st,serverHooks:()=>si,workAsyncStorage:()=>sr,workUnitAsyncStorage:()=>ss});var i,a,n={};r.r(n),r.d(n,{GET:()=>r9,POST:()=>se});var l=r(42706),o=r(28203),u=r(45994),h=r(66443),d=r(16917),c=r(33649),f=r(968),p=r(84311),g=r(26155);let m=g.D_;var y=r(85578),v=r(28312),k=r(50377),x=r(91734),C=r(25574),w=r(87119),S=r(49114),b=r(29024),T=r(67158);function I(e){if(Array.isArray(e))return e.map(I).join("");switch(typeof e){case"string":return e;case"number":case"bigint":return e.toString();case"boolean":return e?"true":"false";default:return""}}var _=r(35432),R=r(14277);let A=Symbol.for("@effect/platform/HttpServerResponse"),D=Symbol.for("@effect/platform/HttpServerRespondable");class N extends C.av{constructor(e,t,r,s,i){if(super(),this.status=e,this.statusText=t,this.cookies=s,this.body=i,this[A]=A,i.contentType||i.contentLength){let e={...r};i.contentType&&(e["content-type"]=i.contentType),i.contentLength&&(e["content-length"]=i.contentLength.toString()),this.headers=e}else this.headers=r}commit(){return h.PyW(this)}[D](){return h.PyW(this)}[w.FX](){return this.toJSON()}toString(){return w.GP(this)}toJSON(){return{_id:"@effect/platform/HttpServerResponse",status:this.status,statusText:this.statusText,headers:w.E$(this.headers),cookies:this.cookies.toJSON(),body:this.body.toJSON()}}}let E=e=>"object"==typeof e&&null!==e&&A in e,P=e=>new N(e?.status??204,e?.statusText,e?.headers??c.Ie,e?.cookies??b.Ie,R.Ie),F=(0,g.XY)(3,(e,t,r)=>new N(e.status,e.statusText,c.hZ(e.headers,t,r),e.cookies,e.body)),O=(e,t)=>h.TjK(R.Pq(e),e=>new N(t?.status??200,t?.statusText,t?.headers??c.Ie,t?.cookies??b.Ie,e)),U=(e,t)=>{let r=new globalThis.Headers(e.headers);if(!b.Im(e.cookies))for(let t of b.IT(e.cookies))r.append("set-cookie",t);if(t?.withoutBody)return new Response(void 0,{status:e.status,statusText:e.statusText,headers:r});let s=e.body;switch(s._tag){case"Empty":return new Response(void 0,{status:e.status,statusText:e.statusText,headers:r});case"Uint8Array":case"Raw":return new Response(s.body,{status:e.status,statusText:e.statusText,headers:r});case"FormData":return new Response(s.formData,{status:e.status,statusText:e.statusText,headers:r});case"Stream":return new Response(S.ior(s.stream,t?.runtime??p.KD),{status:e.status,statusText:e.statusText,headers:r})}},M=Symbol.for("@effect/platform/HttpServerRespondable"),z=e=>(0,x.i5)(e,M),$=P({status:400}),q=P({status:404}),L=e=>E(e)?h.PyW(e):h.QgK(e[M]()),j=(e,t)=>E(e)?h.PyW(e):z(e)?h.uPo(e[M](),()=>h.PyW(t)):k.M8(e)?h.PyW($):v.QR(e)?h.PyW(q):h.PyW(t);var B=r(85284),H=r(89911);let V=Symbol.for("@effect/platform/HttpServerError"),J=(0,H.V)("@effect/platform/HttpServerError/clientAbortFiberId",()=>B.fA(-499,0)),Y=e=>{let t;let r=v.Rw(e,e=>E(e)?(t=e,T.zN(v.Ie)):T.dv());return[t??Q,r]},Q=P({status:500}),W=P({status:499}),X=P({status:503}),K=V;class G extends(0,y.SD)(K,"RequestError"){[M](){return P({status:400})}get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class Z extends(0,y.SD)(K,"RouteNotFound"){constructor(e){super(e),this.stack=`${this.name}: ${this.message}`}[M](){return P({status:404})}get message(){return`${this.request.method} ${this.request.url} not found`}}let ee=e=>{let[t,r]=v.TS(e,[h.PyW(Q),v.Ie],(e,t)=>{switch(t._tag){case"Empty":return T.zN(e);case"Fail":return T.zN([j(t.error,Q),t]);case"Die":return T.zN([j(t.defect,Q),t]);case"Interrupt":{if("Empty"!==e[1]._tag)return T.dv();let r=t.fiberId===J?W:X;return T.zN([h.PyW(r),t])}default:return T.dv()}});return h.TjK(t,e=>v.uH(r)?[e,v.F_(e)]:[e,v.il(r,v.F_(e))])},et=e=>"Success"===e._tag?e.value:Y(e.cause)[0];var er=r(46216),es=r(4545),ei=r(71876),ea=r(9186),en=r(82019),el=r(85392),eo=r(8423),eu=r(53157),eh=r(87455),ed=(r(99522),r(19170),r(45744),r(74722));r(67690),r(21985),r(48832);let ec=Symbol.for("effect/Mailbox"),ef=Symbol.for("effect/Mailbox/ReadonlyMailbox"),ep=ea.Ie(),eg=ed.xtk(ep),em=ed.xtk(!1),ey=ed.xtk(!0),ev=[ep,!0];class ek extends C.Xs{constructor(e,t,r){super(),this[ec]=ec,this[ef]=ef,this.state={_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set},this.messages=[],this.messagesChunk=ea.Ie(),this.shutdown=ed.OH5(()=>{if("Done"===this.state._tag)return!0;this.messages=[],this.messagesChunk=ep;let e=this.state.offers;if(this.finalize("Open"===this.state._tag?ed.x5l:this.state.exit),e.size>0){for(let t of e)"Single"===t._tag?t.resume(em):t.resume(ed.xtk(ea.Iv(t.remaining.slice(t.offset))));e.clear()}return!0}),this.end=this.done(ed.x5l),this.clear=ed.DYE(()=>{if("Done"===this.state._tag)return ed.VuY(this.state.exit,ep);let e=this.unsafeTakeAll();return this.releaseCapacity(),ed.PyW(e)}),this.takeAll=ed.DYE(()=>{if("Done"===this.state._tag)return ed.VuY(this.state.exit,ev);let e=this.unsafeTakeAll();return 0===e.length?ed.aNH(this.awaitTake,this.takeAll):ed.PyW([e,this.releaseCapacity()])}),this.take=ed.DYE(()=>this.unsafeTake()??ed.aNH(this.awaitTake,this.take)),this.await=ed.QUl(e=>"Done"===this.state._tag?e(this.state.exit):(this.state.awaiters.add(e),ed.OH5(()=>{"Done"!==this.state._tag&&this.state.awaiters.delete(e)}))),this.size=ed.OH5(()=>this.unsafeSize()),this.awaitTake=ed.QUl(e=>"Done"===this.state._tag?e(this.state.exit):(this.state.takers.add(e),ed.OH5(()=>{"Done"!==this.state._tag&&this.state.takers.delete(e)}))),this.scheduleRunning=!1,this.releaseTaker=()=>{if(this.scheduleRunning=!1,"Done"===this.state._tag||0===this.state.takers.size)return;let e=eu.z1(this.state.takers);this.state.takers.delete(e),e(ed.x5l)},this.scheduler=e,this.capacity=t,this.strategy=r}offer(e){return ed.DYE(()=>{if("Open"!==this.state._tag)return em;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return em;case"suspend":if(this.capacity<=0&&this.state.takers.size>0)return this.messages.push(e),this.releaseTaker(),ey;return this.offerRemainingSingle(e);case"sliding":return this.unsafeTake(),this.messages.push(e),ey}return this.messages.push(e),this.scheduleReleaseTaker(),ey})}unsafeOffer(e){return"Open"===this.state._tag&&(this.messages.length+this.messagesChunk.length>=this.capacity?"sliding"===this.strategy?(this.unsafeTake(),this.messages.push(e),!0):this.capacity<=0&&this.state.takers.size>0&&(this.messages.push(e),this.releaseTaker(),!0):(this.messages.push(e),this.scheduleReleaseTaker(),!0))}offerAll(e){return ed.DYE(()=>{if("Open"!==this.state._tag)return ed.PyW(ea.Ts(e));let t=this.unsafeOfferAllArray(e);return 0===t.length?eg:"dropping"===this.strategy?ed.PyW(ea.Iv(t)):this.offerRemainingArray(t)})}unsafeOfferAll(e){return ea.Iv(this.unsafeOfferAllArray(e))}unsafeOfferAllArray(e){if("Open"!==this.state._tag)return eo.Ts(e);if(this.capacity===Number.POSITIVE_INFINITY||"sliding"===this.strategy)return this.messages.length>0&&(this.messagesChunk=ea.u2(this.messagesChunk,ea.Iv(this.messages))),"sliding"===this.strategy?this.messagesChunk=this.messagesChunk.pipe(ea.u2(ea.Ts(e)),ea.O6(this.capacity)):ea.yL(e)?this.messagesChunk=ea.u2(this.messagesChunk,e):this.messages=eo.Ts(e),this.scheduleReleaseTaker(),[];let t=this.capacity<=0?this.state.takers.size:this.capacity-this.messages.length-this.messagesChunk.length;if(0===t)return eo.Ts(e);let r=[],s=0;for(let i of e)s<t?this.messages.push(i):r.push(i),s++;return this.scheduleReleaseTaker(),r}fail(e){return this.done(ed.Rkt(e))}failCause(e){return this.done(ed.cbD(e))}unsafeDone(e){return"Open"===this.state._tag&&(0===this.state.offers.size&&0===this.messages.length&&0===this.messagesChunk.length?this.finalize(e):this.state={...this.state,_tag:"Closing",exit:e},!0)}done(e){return ed.OH5(()=>this.unsafeDone(e))}takeN(e){return ed.DYE(()=>{let t;if("Done"===this.state._tag)return ed.VuY(this.state.exit,ev);if(e<=0)return ed.PyW([ep,!1]);if((e=Math.min(e,this.capacity))<=this.messagesChunk.length)t=ea.s(this.messagesChunk,e),this.messagesChunk=ea.gv(this.messagesChunk,e);else{if(!(e<=this.messages.length+this.messagesChunk.length))return ed.aNH(this.awaitTake,this.takeN(e));this.messagesChunk=ea.u2(this.messagesChunk,ea.Iv(this.messages)),this.messages=[],t=ea.s(this.messagesChunk,e),this.messagesChunk=ea.gv(this.messagesChunk,e)}return ed.PyW([t,this.releaseCapacity()])})}unsafeTake(){let e;if("Done"===this.state._tag)return ed.il9(this.state.exit,ed.Rkt(new v.kJ));if(this.messagesChunk.length>0)e=ea.z1(this.messagesChunk),this.messagesChunk=ea.gv(this.messagesChunk,1);else if(this.messages.length>0)e=this.messages[0],this.messagesChunk=ea.gv(ea.Iv(this.messages),1),this.messages=[];else if(this.capacity<=0&&this.state.offers.size>0)return this.capacity=1,this.releaseCapacity(),this.capacity=0,this.messages.length>0?ed.xtk(this.messages.pop()):void 0;else return;return this.releaseCapacity(),ed.xtk(e)}unsafeSize(){let e=this.messages.length+this.messagesChunk.length;return"Done"===this.state._tag?T.dv():T.zN(e)}commit(){return this.takeAll}pipe(){return(0,eh.t)(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return w.GP(this)}[w.FX](){return w.GP(this)}offerRemainingSingle(e){return ed.QUl(t=>{if("Open"!==this.state._tag)return t(em);let r={_tag:"Single",message:e,resume:t};return this.state.offers.add(r),ed.OH5(()=>{"Open"===this.state._tag&&this.state.offers.delete(r)})})}offerRemainingArray(e){return ed.QUl(t=>{if("Open"!==this.state._tag)return t(ed.xtk(ea.Iv(e)));let r={_tag:"Array",remaining:e,offset:0,resume:t};return this.state.offers.add(r),ed.OH5(()=>{"Open"===this.state._tag&&this.state.offers.delete(r)})})}releaseCapacity(){if("Done"===this.state._tag)return"Success"===this.state.exit._tag;if(0===this.state.offers.size)return"Closing"===this.state._tag&&0===this.messages.length&&0===this.messagesChunk.length&&(this.finalize(this.state.exit),"Success"===this.state.exit._tag);let e=this.capacity-this.messages.length-this.messagesChunk.length;for(let t of this.state.offers){if(0===e)break;if("Single"===t._tag)this.messages.push(t.message),e--,t.resume(ey),this.state.offers.delete(t);else{for(;t.offset<t.remaining.length;t.offset++){if(0===e)return!1;this.messages.push(t.remaining[t.offset]),e--}t.resume(eg),this.state.offers.delete(t)}}return!1}scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}unsafeTakeAll(){if(this.messagesChunk.length>0){let e=this.messages.length>0?ea.u2(this.messagesChunk,ea.Iv(this.messages)):this.messagesChunk;return this.messagesChunk=ep,this.messages=[],e}if(this.messages.length>0){let e=ea.Iv(this.messages);return this.messages=[],e}return"Done"!==this.state._tag&&this.state.offers.size>0?(this.capacity=1,this.releaseCapacity(),this.capacity=0,ea.of(this.messages.pop())):ep}finalize(e){if("Done"===this.state._tag)return;let t=this.state;for(let r of(this.state={_tag:"Done",exit:e},t.takers))r(e);for(let r of(t.takers.clear(),t.awaiters))r(e);t.awaiters.clear()}}let ex=e=>ed.$we(t=>ed.PyW(new ek(t.currentScheduler,"number"==typeof e?e:e?.capacity??Number.POSITIVE_INFINITY,"number"==typeof e?"suspend":e?.strategy??"suspend"))),eC=((e,t)=>ed.FcF(r=>ed.khu(r(e),{onFailure:e=>t.failCause(e),onSuccess:e=>t.end})),/; *([!#$%&'*+.^\w`|~-]+)=("(?:[\v\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\v\u0020-\u00ff])*"|[!#$%&'*+.^\w`|~-]+) */gu),ew=/\\([\v\u0020-\u00ff])/gu,eS=/^[!#$%&'*+.^\w|~-]+\/[!#$%&'*+.^\w|~-]+$/u,eb=/^[!#$%&'*+.^\w|~-]+$/u,eT={value:"",parameters:Object.create(null)};function eI(e,t=!1){let r,s,i;if("string"!=typeof e)return eT;let a=e.indexOf(";"),n=-1!==a?e.slice(0,a).trim():e.trim();if(!1===(t?eb:eS).test(n))return eT;let l={value:n.toLowerCase(),parameters:Object.create(null)};if(-1===a)return l;for(eC.lastIndex=a;s=eC.exec(e);){if(s.index!==a)return eT;a+=s[0].length,r=s[1].toLowerCase(),'"'===(i=s[2])[0]&&(i=i.slice(1,i.length-1),!t&&ew.test(i)&&(i=i.replace(ew,"$1"))),l.parameters[r]=i}return a!==e.length?eT:l}!function(e){e[e.key=0]="key",e[e.whitespace=1]="whitespace",e[e.value=2]="value"}(i||(i={}));let e_={_tag:"Continue"},eR=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1],eA=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];!function(e){e[e.headers=0]="headers",e[e.body=1]="body"}(a||(a={}));let eD={_tag:"InvalidDisposition"},eN={_tag:"EndNotReached"},eE={_tag:"ReachedLimit",limit:"MaxParts"},eP={_tag:"ReachedLimit",limit:"MaxTotalSize"},eF={_tag:"ReachedLimit",limit:"MaxPartSize"},eO={_tag:"ReachedLimit",limit:"MaxFieldSize"},eU=new TextEncoder().encode("\r\n");function eM(e){return void 0!==e.filename||"application/octet-stream"===e.contentType}function ez(e){}let e$=new TextDecoder("utf-8"),eq=function({headers:e,onFile:t,onField:r,onError:s,onDone:n,isFile:l=eM,maxParts:o=1/0,maxTotalSize:u=1/0,maxPartSize:h=1/0,maxFieldSize:d=1048576}){let c=eI(e["content-type"]).parameters.boundary;if(void 0===c)return s({_tag:"InvalidBoundary"}),{write:ez,end(){}};let f={state:a.headers,index:0,parts:0,onChunk:ez,info:void 0,headerSkip:0,partSize:0,totalSize:0,isFile:!1,fieldChunks:[],fieldSize:0};function p(){f.state=a.body,f.isFile=!0,f.onChunk=ez}let g=function(){let e=new TextDecoder,t={state:i.key,headers:Object.create(null),key:"",value:void 0,crlf:0,previousChunk:void 0,pairs:0,size:0};function r(e){return t.state=i.key,t.headers=Object.create(null),t.key="",t.value=void 0,t.crlf=0,t.previousChunk=void 0,t.pairs=0,t.size=0,e}function s(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function a(e){return r({_tag:"Failure",reason:e,headers:t.headers})}return function(n,l){let o,u=0;if(void 0!==t.previousChunk){o=u=t.previousChunk.length;let e=new Uint8Array(n.length+u);e.set(t.previousChunk),e.set(n,u),t.previousChunk=void 0,n=e}let h=n.length;e:for(;l<h;){if(t.state===i.key){let r=l;for(;r<h;r++){if(t.size++>16384)return a("HeaderTooLarge");if(58===n[r]){if(t.key+=e.decode(n.subarray(l,r)).toLowerCase(),0===t.key.length)return a("InvalidHeaderName");32===n[r+1]&&32!==n[r+2]&&9!==n[r+2]?(l=r+2,t.state=i.value,t.size++):32!==n[r+1]&&9!==n[r+1]?(l=r+1,t.state=i.value):(l=r+1,t.state=i.whitespace);break}if(1!==eR[n[r]])return a("InvalidHeaderName")}if(r===h)return t.key+=e.decode(n.subarray(l,h)).toLowerCase(),e_}if(t.state===i.whitespace){for(;l<h;l++){if(t.size++>16384)return a("HeaderTooLarge");if(32!==n[l]&&9!==n[l]){t.state=i.value;break}}if(l===h)return e_}if(t.state===i.value){let d=l;for(void 0!==o&&(d=o,o=void 0);d<h;d++){if(t.size++>16384)return a("HeaderTooLarge");if(13===n[d]||t.crlf>0){let o=n[d];if(13===o&&0===t.crlf&&(t.crlf=1,d++,t.size++,o=n[d]),10===o&&1===t.crlf&&(t.crlf=2,d++,t.size++,o=n[d]),13===o&&2===t.crlf&&(t.crlf=3,d++,t.size++,o=n[d]),10===o&&3===t.crlf&&(t.crlf=4,d++,t.size++),t.crlf<4&&d>=h)return t.previousChunk=n.subarray(l),e_;if(t.crlf>=2){t.value=void 0===t.value?n.subarray(l,d-t.crlf):s(t.value,n.subarray(l,d-t.crlf));let o=e.decode(t.value);if(void 0===t.headers[t.key]?t.headers[t.key]=o:"string"==typeof t.headers[t.key]?t.headers[t.key]=[t.headers[t.key],o]:t.headers[t.key].push(o),l=d,t.size--,4!==t.crlf&&100===t.pairs)return a("TooManyHeaders");if(3===t.crlf)return a("InvalidHeaderValue");if(4===t.crlf)return r({_tag:"Headers",headers:t.headers,endPosition:l-u});t.pairs++,t.key="",t.value=void 0,t.crlf=0,t.state=i.key;continue e}}else if(1!==eA[n[d]])return a("InvalidHeaderValue")}if(d===h)return t.value=void 0===t.value?n.subarray(l,h):s(t.value,n.subarray(l,h)),e_}}return l>h&&(t.size+=h-l),e_}}(),m=function(e,t,r){let s=function(e){let t=new TextEncoder().encode(e),r=t.length,s={};for(let e=0;e<r;e++){let r=t[e];void 0===s[r]&&(s[r]=[]),s[r].push(e)}return{needle:t,needleLength:r,indexes:s,firstByte:t[0],previousChunk:void 0,previousChunkLength:0,matchIndex:0}}(e);void 0!==r&&(s.previousChunk=r,s.previousChunkLength=r.length);let i=function(){if("Buffer"in globalThis&&!("Bun"in globalThis||"Deno"in globalThis))return function(e,t,r){return Buffer.prototype.indexOf.call(e,t,r)};let e=new Uint8Array(256).fill(s.needle.length);for(let t=0,r=s.needle.length-1;t<r;++t)e[s.needle[t]]=r-t;return function(t,r,i){let a=t.length,n=i+s.needleLength-1;for(;n<a;){for(let e=s.needleLength-1,i=n;e>=0&&t[i]===r[e];e--,i--)if(0===e)return i;n+=e[t[n]]}return -1}}();return{write:function(e){let r=e.length;if(void 0!==s.previousChunk){let t=new Uint8Array(s.previousChunkLength+r);t.set(s.previousChunk),t.set(e,s.previousChunkLength),e=t,r=s.previousChunkLength+r,s.previousChunk=void 0}if(r<s.needleLength){s.previousChunk=e,s.previousChunkLength=r;return}let a=0;for(;a<r;){let n=i(e,s.needle,a);if(n>-1){n>a&&t(s.matchIndex,e.subarray(a,n)),s.matchIndex+=1,a=n+s.needleLength;continue}if(e[r-1]in s.indexes){let i=s.indexes[e[r-1]],n=-1;for(let t=0,a=i.length;t<a;t++){let a=i[t];e[r-1-a]===s.firstByte&&t>n&&(n=a)}-1===n?0===a?t(s.matchIndex,e):t(s.matchIndex,e.subarray(a)):(r-1-n>a&&t(s.matchIndex,e.subarray(a,r-1-n)),s.previousChunk=e.subarray(r-1-n),s.previousChunkLength=n+1)}else 0===a?t(s.matchIndex,e):t(s.matchIndex,e.subarray(a));break}},end:function(){void 0!==s.previousChunk&&s.previousChunk!==r&&t(s.matchIndex,s.previousChunk),s.previousChunk=r,s.previousChunkLength=r?.length??0,s.matchIndex=0}}}(`\r
--${c}`,function(e,i){if(0===e){p();return}if(e!==f.index){if(f.index>0){if(f.isFile)f.onChunk(null),f.partSize=0;else{if(1===f.fieldChunks.length)r(f.info,f.fieldChunks[0]);else{let e=new Uint8Array(f.fieldSize),t=0;for(let r=0;r<f.fieldChunks.length;r++){let s=f.fieldChunks[r];e.set(s,t),t+=s.length}r(f.info,e)}f.fieldSize=0,f.fieldChunks=[]}}if(f.state=a.headers,f.index=e,f.headerSkip=2,45===i[0]&&45===i[1])return n();f.parts++,f.parts>o&&s(eE)}if((f.partSize+=i.length)>h&&s(eF),f.state===a.headers){let e;let r=g(i,f.headerSkip);if(f.headerSkip=0,"Continue"===r._tag)return;if("Failure"===r._tag)return p(),s({_tag:"BadHeaders",error:r});let n=eI(r.headers["content-type"]),o=eI(r.headers["content-disposition"],!0);if("form-data"===o.value&&!("name"in o.parameters))return p(),s(eD);if("filename*"in o.parameters){let t=o.parameters["filename*"].split("''");2===t.length&&(e=decodeURIComponent(t[1]))}if(f.info={name:o.parameters.name??"",filename:e??o.parameters.filename,contentType:""===n.value?void 0!==o.parameters.filename?"application/octet-stream":"text/plain":n.value,contentTypeParameters:n.parameters,contentDisposition:o.value,contentDispositionParameters:o.parameters,headers:r.headers},f.state=a.body,f.isFile=l(f.info),f.isFile&&(f.onChunk=t(f.info)),r.endPosition<i.length){if(f.isFile)f.onChunk(i.subarray(r.endPosition));else{let e=i.subarray(r.endPosition);(f.fieldSize+=e.length)>d&&s(eO),f.fieldChunks.push(e)}}}else f.isFile?f.onChunk(i):((f.fieldSize+=i.length)>d&&s(eO),f.fieldChunks.push(i))},eU);return{write:e=>(f.totalSize+=e.length)>u?s(eP):m.write(e),end(){m.end(),f.state===a.body&&s(eN),f.state=a.headers,f.index=0,f.parts=0,f.onChunk=ez,f.info=void 0,f.totalSize=0,f.partSize=0,f.fieldChunks=[],f.fieldSize=0}}};var eL=r(52171),ej=r(74282);let eB=Symbol.for("@effect/platform/Path"),eH=(0,f.Io)("@effect/platform/Path");function eV(e,t){let r,s="",i=0,a=-1,n=0;for(let l=0;l<=e.length;++l){if(l<e.length)r=e.charCodeAt(l);else if(47===r)break;else r=47;if(47===r){if(a===l-1||1===n);else if(a!==l-1&&2===n){if(s.length<2||2!==i||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2)){if(s.length>2){let e=s.lastIndexOf("/");if(e!==s.length-1){-1===e?(s="",i=0):i=(s=s.slice(0,e)).length-1-s.lastIndexOf("/"),a=l,n=0;continue}}else if(2===s.length||1===s.length){s="",i=0,a=l,n=0;continue}}t&&(s.length>0?s+="/..":s="..",i=2)}else s.length>0?s+="/"+e.slice(a+1,l):s=e.slice(a+1,l),i=l-a-1;a=l,n=0}else 46===r&&-1!==n?++n:n=-1}return s}let eJ=function(){let e,t="",r=!1;for(let s=arguments.length-1;s>=-1&&!r;s--){let i;if(s>=0)i=arguments[s];else{let t=globalThis.process;void 0===e&&"process"in globalThis&&"object"==typeof t&&null!==t&&"function"==typeof t.cwd&&(e=t.cwd()),i=e}0!==i.length&&(t=i+"/"+t,r=47===i.charCodeAt(0))}return(t=eV(t,!r),r)?t.length>0?"/"+t:"/":t.length>0?t:"."},eY=/%/g,eQ=/\\/g,eW=/\n/g,eX=/\r/g,eK=/\t/g,eG=eH.of({[eB]:eB,resolve:eJ,normalize(e){if(0===e.length)return".";let t=47===e.charCodeAt(0),r=47===e.charCodeAt(e.length-1);return(0!==(e=eV(e,!t)).length||t||(e="."),e.length>0&&r&&(e+="/"),t)?"/"+e:e},isAbsolute:e=>e.length>0&&47===e.charCodeAt(0),join(){let e;if(0==arguments.length)return".";for(let t=0;t<arguments.length;++t){let r=arguments[t];r.length>0&&(void 0===e?e=r:e+="/"+r)}return void 0===e?".":eG.normalize(e)},relative(e,t){if(e===t||(e=eG.resolve(e),t=eG.resolve(t),e===t))return"";let r=1;for(;r<e.length&&47===e.charCodeAt(r);++r);let s=e.length,i=s-r,a=1;for(;a<t.length&&47===t.charCodeAt(a);++a);let n=t.length-a,l=i<n?i:n,o=-1,u=0;for(;u<=l;++u){if(u===l){if(n>l){if(47===t.charCodeAt(a+u))return t.slice(a+u+1);if(0===u)return t.slice(a+u)}else i>l&&(47===e.charCodeAt(r+u)?o=u:0===u&&(o=0));break}let s=e.charCodeAt(r+u);if(s!==t.charCodeAt(a+u))break;47===s&&(o=u)}let h="";for(u=r+o+1;u<=s;++u)(u===s||47===e.charCodeAt(u))&&(0===h.length?h+="..":h+="/..");return h.length>0?h+t.slice(a+o):(a+=o,47===t.charCodeAt(a)&&++a,t.slice(a))},dirname(e){if(0===e.length)return".";let t=e.charCodeAt(0),r=47===t,s=-1,i=!0;for(let r=e.length-1;r>=1;--r)if(47===(t=e.charCodeAt(r))){if(!i){s=r;break}}else i=!1;return -1===s?r?"/":".":r&&1===s?"//":e.slice(0,s)},basename(e,t){let r,s=0,i=-1,a=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let n=t.length-1,l=-1;for(r=e.length-1;r>=0;--r){let o=e.charCodeAt(r);if(47===o){if(!a){s=r+1;break}}else -1===l&&(a=!1,l=r+1),n>=0&&(o===t.charCodeAt(n)?-1==--n&&(i=r):(n=-1,i=l))}return s===i?i=l:-1===i&&(i=e.length),e.slice(s,i)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!a){s=r+1;break}}else -1===i&&(a=!1,i=r+1);return -1===i?"":e.slice(s,i)},extname(e){let t=-1,r=0,s=-1,i=!0,a=0;for(let n=e.length-1;n>=0;--n){let l=e.charCodeAt(n);if(47===l){if(!i){r=n+1;break}continue}-1===s&&(i=!1,s=n+1),46===l?-1===t?t=n:1!==a&&(a=1):-1!==t&&(a=-1)}return -1===t||-1===s||0===a||1===a&&t===s-1&&t===r+1?"":e.slice(t,s)},format:function(e){if(null===e||"object"!=typeof e)throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){let r=t.dir||t.root,s=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+s:r+"/"+s:s}(0,e)},parse(e){let t;let r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;let s=e.charCodeAt(0),i=47===s;i?(r.root="/",t=1):t=0;let a=-1,n=0,l=-1,o=!0,u=e.length-1,h=0;for(;u>=t;--u){if(47===(s=e.charCodeAt(u))){if(!o){n=u+1;break}continue}-1===l&&(o=!1,l=u+1),46===s?-1===a?a=u:1!==h&&(h=1):-1!==a&&(h=-1)}return -1===a||-1===l||0===h||1===h&&a===l-1&&a===n+1?-1!==l&&(0===n&&i?r.base=r.name=e.slice(1,l):r.base=r.name=e.slice(n,l)):(0===n&&i?(r.name=e.slice(1,a),r.base=e.slice(1,l)):(r.name=e.slice(n,a),r.base=e.slice(n,l)),r.ext=e.slice(a,l)),n>0?r.dir=e.slice(0,n-1):i&&(r.dir="/"),r},sep:"/",fromFileUrl:function(e){if("file:"!==e.protocol)return h.fJG((0,y.dB)({module:"Path",method:"fromFileUrl",message:"URL must be of scheme file"}));if(""!==e.hostname)return h.fJG((0,y.dB)({module:"Path",method:"fromFileUrl",message:"Invalid file URL host"}));let t=e.pathname;for(let e=0;e<t.length;e++)if("%"===t[e]){let r=32|t.codePointAt(e+2);if("2"===t[e+1]&&102===r)return h.fJG((0,y.dB)({module:"Path",method:"fromFileUrl",message:"must not include encoded / characters"}))}return h.PyW(decodeURIComponent(t))},toFileUrl:function(e){var t;let r=new URL("file://"),s=eJ(e);return 47===e.charCodeAt(e.length-1)&&"/"!==s[s.length-1]&&(s+="/"),r.pathname=((t=s).includes("%")&&(t=t.replace(eY,"%25")),t.includes("\\")&&(t=t.replace(eQ,"%5C")),t.includes("\n")&&(t=t.replace(eW,"%0A")),t.includes("\r")&&(t=t.replace(eX,"%0D")),t.includes("	")&&(t=t.replace(eK,"%09")),t),h.PyW(r)},toNamespacedPath:g.D_}),eZ=Symbol.for("@effect/platform/Multipart"),e1=Symbol.for("@effect/platform/Multipart/MultipartError");class e0 extends(0,y.SD)(e1,"MultipartError"){get message(){return this.reason}}let e4=(0,H.V)("@effect/platform/Multipart/maxParts",()=>el.p5(T.dv())),e2=(0,H.V)("@effect/platform/Multipart/maxFieldSize",()=>el.p5(eL.or(0xa00000))),e5=(0,H.V)("@effect/platform/Multipart/maxFileSize",()=>el.p5(T.dv())),e7=(0,H.V)("@effect/platform/Multipart/fieldMimeTypes",()=>el.p5(ea.L8("application/json"))),e8=e=>h.$we(t=>{let r=t.getFiberRef(e7);return h.PyW({headers:e,maxParts:T.Y6(t.getFiberRef(e4)),maxFieldSize:Number(t.getFiberRef(e2)),maxPartSize:t.getFiberRef(e5).pipe(T.Tj(Number),T.Y6),maxTotalSize:t.getFiberRef(ei.uw).pipe(T.Tj(Number),T.Y6),isFile:0===r.length?void 0:e=>!ea.zN(r,t=>e.contentType.includes(t))&&eM(e)})}),e3=e=>"Success"===e._tag?er.rI:er.AT(e.cause);class e6 extends w.Xs{constructor(){super(),this[eZ]=eZ}}class e9 extends e6{constructor(e,t,r){super(),this._tag="Field",this.key=e,this.contentType=t,this.value=r}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"Field",key:this.key,contentType:this.contentType,value:this.value}}}class te extends e6{constructor(e,t){super(),this._tag="File",this.key=e.name,this.name=e.filename??e.name,this.contentType=e.contentType,this.content=S.EfB(t)}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"File",key:this.key,name:this.name,contentType:this.contentType}}}let tt=(e,t)=>h.qIB(eL.Q2,r=>h.xm_(S.eFU(t.content,r.sink(e)),e=>new e0({reason:"InternalError",cause:e})));class tr extends e6{constructor(e,t,r,s){super(),this._tag="PersistedFile",this.key=e,this.name=t,this.contentType=r,this.path=s}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"PersistedFile",key:this.key,name:this.name,contentType:this.contentType,path:this.path}}}let ts=(e,t=16)=>er.jG(h.Q7R([e8(e),ex(t)]),([e,t])=>{let r=[],s=T.dv(),i=eq({...e,onField(e,t){r.push(new e9(e.name,e.contentType,(function(e){if("utf-8"===e||"utf8"===e||""===e)return e$;try{return new TextDecoder(e)}catch(e){return e$}})(e.contentTypeParameters.charset??"utf-8").decode(t)))},onFile(e){let t=[],s=!1,i=er.DY(()=>{if(0===t.length)return s?er.rI:er.aN(a,i);let e=ea.Iv(t);return t=[],s?er.M9(e):er.aN(er.M9(e),er.aN(a,i))});return r.push(new te(e,i)),function(e){null===e?s=!0:t.push(e)}},onError(e){s=T.zN(en.fJ(function(e){if("ReachedLimit"===e._tag)switch(e.limit){case"MaxParts":return new e0({reason:"TooManyParts",cause:e});case"MaxFieldSize":return new e0({reason:"FieldTooLarge",cause:e});case"MaxPartSize":return new e0({reason:"FileTooLarge",cause:e});case"MaxTotalSize":return new e0({reason:"BodyTooLarge",cause:e})}return new e0({reason:"Parse",cause:e})}(e)))},onDone(){s=T.zN(en.rI)}}),a=er.qI(t.takeAll,([e,t])=>er.OH(()=>{ea.jJ(e,ea.jJ(i.write)),t&&i.end()})),n=er.qI(a,()=>{if(0===r.length)return"None"===s._tag?n:e3(s.value);let e=ea.Iv(r);return r=[],er.aN(er.M9(e),"None"===s._tag?n:e3(s.value))});return er.wO(n,{awaitRead:()=>h.rIH,emit:e=>t.offer(e),error:e=>(s=T.zN(en.AT(e)),t.end),done:e=>t.end})},([,e])=>e.shutdown),ti=(e,t=tt)=>h.JkU(function*(){let r=yield*eL.Q2,s=yield*eH,i=yield*r.makeTempDirectoryScoped(),a=Object.create(null);return yield*S.o1d(e,e=>{if("Field"===e._tag)return e.key in a?"string"==typeof a[e.key]?a[e.key]=[a[e.key],e.value]:a[e.key].push(e.value):a[e.key]=e.value,h.rIH;if(""===e.name)return h.rIH;let r=s.join(i,s.basename(e.name).slice(-128)),n=new tr(e.key,e.name,e.contentType,r);return Array.isArray(a[e.key])?a[e.key].push(n):a[e.key]=[n],t(r,e)}),a}).pipe(h.loE({SystemError:e=>h.fJG(new e0({reason:"InternalError",cause:e})),BadArgument:e=>h.fJG(new e0({reason:"InternalError",cause:e}))}));r(35340),r(42287);let ta=Symbol.for("@effect/platform/HttpServerRequest"),tn=f.Io("@effect/platform/HttpServerRequest"),tl=f.Io("@effect/platform/HttpServerRequest/ParsedSearchParams"),to=e=>{if("/"===e[0])return e;let t=e.indexOf("/",e.indexOf("//")+2);return -1===t?"/":e.slice(t)};class tu extends w.Xs{static{ei.ii}constructor(e,t,r,s){super(),this.source=e,this.url=t,this.headersOverride=r,this.remoteAddressOverride=s,this[ta]=ta,this[ei.ii]=ei.ii}toJSON(){return ei.Nn(this,{_id:"@effect/platform/HttpServerRequest",method:this.method,url:this.originalUrl})}modify(e){return new tu(this.source,e.url??this.url,e.headers??this.headersOverride,e.remoteAddress??this.remoteAddressOverride)}get method(){return this.source.method.toUpperCase()}get originalUrl(){return this.source.url}get remoteAddress(){return this.remoteAddressOverride?T.zN(this.remoteAddressOverride):T.dv()}get headers(){return this.headersOverride??=c.lX(this.source.headers),this.headersOverride}get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=b.RW(this.headers.cookie??"")}get stream(){return this.source.body?S.fph(()=>this.source.body,e=>new G({request:this,reason:"Decode",cause:e})):S.fJG(new G({request:this,reason:"Decode",description:"can not create stream from empty body"}))}get text(){return this.textEffect||(this.textEffect=h.HZF(h.PO3(h.$mh({try:()=>this.source.text(),catch:e=>new G({request:this,reason:"Decode",cause:e})})))),this.textEffect}get json(){return h.gZ9(this.text,{try:e=>JSON.parse(e),catch:e=>new G({request:this,reason:"Decode",cause:e})})}get urlParamsBody(){return h.qIB(this.text,e=>h.SvU({try:()=>_.lX(new URLSearchParams(e)),catch:e=>new G({request:this,reason:"Decode",cause:e})}))}get multipart(){return this.multipartEffect||(this.multipartEffect=h.HZF(h.PO3(ti(this.multipartStream)))),this.multipartEffect}get multipartStream(){return S.tyW(S.xm_(this.stream,e=>new e0({reason:"InternalError",cause:e})),ts(this.headers))}get arrayBuffer(){return this.arrayBuffer?this.arrayBuffer:(this.arrayBufferEffect=h.HZF(h.PO3(h.$mh({try:()=>this.source.arrayBuffer(),catch:e=>new G({request:this,reason:"Decode",cause:e})}))),this.arrayBufferEffect)}get upgrade(){return h.fJG(new G({request:this,reason:"Decode",description:"Not an upgradeable ServerRequest"}))}}let th=(e,t)=>{let r=ei.Ax(e,t);return h.qIB(tn,r)},td=(e,t)=>{let r=ei._u(e,t);return h.qIB(tn,r)},tc=e=>new tu(e,to(e.url)),tf=e=>{let t=e.headers.host??"localhost",r="https"===e.headers["x-forwarded-proto"]?"https":"http";try{return T.zN(new URL(e.url,`${r}://${t}`))}catch(e){return T.dv()}},tp=(0,H.V)(Symbol.for("@effect/platform/HttpApp/preResponseHandlers"),()=>el.p5(T.dv()));var tg=r(39279);let tm=(0,H.V)(Symbol.for("@effect/platform/HttpMiddleware/tracerDisabledWhen"),()=>el.p5(g.f4)),ty=e=>h.$we(t=>{let r=f.$v(t.currentContext,tn);if(t.getFiberRef(tm)(r))return e;let s=T.Y6(tf(r));void 0!==s&&(""!==s.username||""!==s.password)&&(s.username="REDACTED",s.password="REDACTED");let i=t.getFiberRef(c.Oj),a=c.E$(r.headers,i);return h.gvr(`http.server ${r.method}`,{parent:T.Y6(tg.zB(r.headers)),kind:"server",captureStackTrace:!1},t=>{for(let e in t.attribute("http.request.method",r.method),void 0!==s&&(t.attribute("url.full",s.toString()),t.attribute("url.path",s.pathname),""!==s.search.slice(1)&&t.attribute("url.query",s.search.slice(1)),t.attribute("url.scheme",s.protocol.slice(0,-1))),void 0!==r.headers["user-agent"]&&t.attribute("user_agent.original",r.headers["user-agent"]),a)t.attribute(`http.request.header.${e}`,String(a[e]));return"Some"===r.remoteAddress._tag&&t.attribute("client.address",r.remoteAddress.value),h.qIB(h.NS5(h.hq(e,t)),e=>{let r=et(e);t.attribute("http.response.status_code",r.status);let s=c.E$(r.headers,i);for(let e in s)t.attribute(`http.response.header.${e}`,String(s[e]));return e})})}),tv=Symbol.for("@effect/platform/HttpApp/handled"),tk=(e,t,r)=>{let s=h.$we(r=>h.qIB(e,e=>{let s=f.$v(r.currentContext,tn),i=r.getFiberRef(tx);return"None"===i._tag?(s[tv]=!0,h.as(t(s,e),e)):h.Mim(i.value(s,e),e=>(s[tv]=!0,t(s,e)))})),i=h.uPo(s,e=>h.$we(r=>h.qIB(ee(e),([e,s])=>{let i=f.$v(r.currentContext,tn),a=r.getFiberRef(tx);return"None"===a._tag?(i[tv]=!0,h.aNH(t(i,e),h.ATB(s))):h.aNH(h.Mim(a.value(i,e),e=>(i[tv]=!0,t(i,e))),h.ATB(s))}))),a=m(void 0===r?ty(i):h.khu(r(ty(i)),{onFailure:e=>h.$we(r=>{let s=f.$v(r.currentContext,tn);return tv in s?h.rIH:h.khu(ee(e),{onFailure:e=>t(s,P({status:500})),onSuccess:([e])=>t(s,e)})}),onSuccess:e=>h.$we(r=>{let s=f.$v(r.currentContext,tn);return tv in s?h.rIH:t(s,e)})}));return h.rfi(h.P1j(a))},tx=tp,tC=e=>{let t=p.MY(e);return(r,s)=>{let i=Symbol.for("@effect/platform/HttpApp/resolve"),a=tk(r,(t,r)=>(t[i](U(r,{withoutBody:"HEAD"===t.method,runtime:e})),h.rIH),s);return e=>new Promise(r=>{let s=tc(e);s[i]=r;let n=t(h.PfK(a,tn,s));e.signal?.addEventListener("abort",()=>{n.unsafeInterruptAsFork(J)},{once:!0})})}};p.KD;var tw=r(46430);let tS=/\+/g,tb=function(){};tb.prototype=Object.create(null);let tT=Array.from({length:256},(e,t)=>"%"+((t<16?"0":"")+t.toString(16)).toUpperCase()),tI=new Int8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0]),t_=/^https?:\/\/.*?\//,tR=/(\/:[^/()]*?)\?(\/?)/;class tA{constructor(e={}){this.options={ignoreTrailingSlash:!0,ignoreDuplicateSlashes:!0,caseSensitive:!1,maxParamLength:100,...e}}options;routes=[];trees={};on(e,t,r){let s=t.match(tR);if(s&&void 0!==s.index){tU(t.length===s.index+s[0].length,"Optional Parameter needs to be the last parameter of the path");let i=t.replace(tR,"$1$2"),a=t.replace(tR,"$2");this.on(e,i,r),this.on(e,a,r);return}for(let s of(this.options.ignoreDuplicateSlashes&&(t=tM(t)),this.options.ignoreTrailingSlash&&(t=tz(t)),"string"==typeof e?[e]:e))this._on(s,t,r)}all(e,t){this.on(tL,e,t)}_on(e,t,r){void 0===this.trees[e]&&(this.trees[e]=new tP("/"));let s=t;if("*"===s&&0!==this.trees[e].prefix.length){let t=this.trees[e];this.trees[e]=new tP(""),this.trees[e].staticChildren["/"]=t}let i=this.trees[e].prefix.length,a=this.trees[e],n=[];for(let e=0;e<=s.length;e++){if(58===s.charCodeAt(e)&&58===s.charCodeAt(e+1)){e++;continue}let t=58===s.charCodeAt(e)&&58!==s.charCodeAt(e+1),r=42===s.charCodeAt(e);if(t||r||e===s.length&&e!==i){let t=s.slice(i,e);this.options.caseSensitive||(t=t.toLowerCase()),t=(t=t.split("::").join(":")).split("%").join("%25"),a=a.createStaticChild(t)}if(t){let t=!1,r=[],o=e+1;for(let u=o;;u++){let h=s.charCodeAt(u),d=40===h,c=45===h||46===h,f=47===h||u===s.length;if(d||c||f){let h=s.slice(o,u);if(n.push(h),t=t||d||c,d){var l;let e=function(e,t){let r=1;for(;t<e.length;){if("\\"===e[++t]){t++;continue}if(")"===e[t]?r--:"("===e[t]&&r++,!r)return t}throw TypeError('Invalid regexp expression in "'+e+'"')}(s,u),t=s.slice(u,e+1);r.push((94===(l=t).charCodeAt(1)&&(l=l.slice(0,1)+l.slice(2)),36===l.charCodeAt(l.length-2)&&(l=l.slice(0,l.length-2)+l.slice(l.length-1)),l)),u=e+1}else r.push("(.*?)");let p=u;for(;u<s.length;u++){let e=s.charCodeAt(u);if(47===e)break;if(58===e){if(58===s.charCodeAt(u+1))u++;else break}}let g=s.slice(p,u);if(g&&(g=(g=g.split("::").join(":")).split("%").join("%25"),r.push(g.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))),o=u+1,f||47===s.charCodeAt(u)||u===s.length){let n=t?"()"+g:g,l=s.slice(e,u);s=s.slice(0,e+1)+n+s.slice(u),e+=n.length;let o=t?RegExp("^"+r.join("")+"$"):void 0;a=a.createParametricChild(o,g,l),i=e+1;break}}}}else if(r&&(n.push("*"),a=a.createWildcardChild(),i=e+1,e!==s.length-1))throw Error("Wildcard must be the last character in the route")}for(let t of(this.options.caseSensitive||(s=s.toLowerCase()),"*"===s&&(s="/*"),this.routes))if(t.method===e&&t.pattern===s)throw Error(`Method '${e}' already declared for route '${s}'`);let o={method:e,path:t,pattern:s,params:n,handler:r};this.routes.push(o),a.addRoute(o)}has(e,t){let r=this.trees[e];if(void 0===r)return!1;let s=r.getStaticChild(t);return void 0!==s&&s.isLeafNode}find(e,t){let r,s,i,a=this.trees[e];if(void 0===a)return;47!==t.charCodeAt(0)&&(t=t.replace(t_,"/")),this.options.ignoreDuplicateSlashes&&(t=tM(t));try{t=(r=function(e){let t=!1,r=!1,s="";for(let i=1;i<e.length;i++){let a=e.charCodeAt(i);if(37===a){let s=e.charCodeAt(i+1),a=e.charCodeAt(i+2);void 0===t$(s,a)?t=!0:(r=!0,50===s&&53===a&&(t=!0,e=e.slice(0,i+1)+"25"+e.slice(i+1),i+=2),i+=2)}else if(63===a||59===a||35===a){s=e.slice(i+1),e=e.slice(0,i);break}}return{path:t?decodeURI(e):e,querystring:s,shouldDecodeParam:r}}(t)).path,s=r.querystring,i=r.shouldDecodeParam}catch(e){return}this.options.ignoreTrailingSlash&&(t=tz(t));let n=t;!1===this.options.caseSensitive&&(t=t.toLowerCase());let l=this.options.maxParamLength,o=a.prefix.length,u=[],h=t.length,d=[];for(;;){if(o===h&&a.isLeafNode){let e=a.handlerStorage?.find();if(void 0!==e)return{handler:e.handler,params:e.createParams(u),searchParams:function(e){let t=new tb;if("string"!=typeof e)return t;let r=e.length,s="",i="",a=-1,n=-1,l=!1,o=!1,u=!1,h=!1,d=!1,c=0;for(let f=0;f<r+1;f++)if(38===(c=f!==r?e.charCodeAt(f):38)){if((d=n>a)||(n=f),s=e.slice(a+1,n),d||s.length>0){u&&(s=s.replace(tS," ")),l&&(s=decodeURIComponent(s)||s),d&&(i=e.slice(n+1,f),h&&(i=i.replace(tS," ")),o&&(i=decodeURIComponent(i)||i));let r=t[s];void 0===r?t[s]=i:r.pop?r.push(i):t[s]=[r,i]}i="",a=f,n=f,l=!1,o=!1,u=!1,h=!1}else 61===c?n<=a?n=f:o=!0:43===c?n>a?h=!0:u=!0:37===c&&(n>a?o=!0:l=!0);return t}(s)}}let e=a.getNextNode(t,o,d,u.length);if(void 0===e){if(0===d.length)return;let t=d.pop();o=t.brotherPathIndex,u.splice(t.paramsCount),e=t.brotherNode}if("StaticNode"===(a=e)._tag){o+=a.prefix.length;continue}if("WildcardNode"===a._tag){let e=n.slice(o);i&&(e=tq(e)),u.push(e),o=h;continue}if("ParametricNode"===a._tag){let e=n.indexOf("/",o);-1===e&&(e=h);let t=n.slice(o,e);if(i&&(t=tq(t)),void 0!==a.regex){let e=a.regex.exec(t);if(null===e)continue;for(let t=1;t<e.length;t++){let r=e[t];if(r.length>l)return;u.push(r)}}else{if(t.length>l)return;u.push(t)}o=e}}}}class tD{handlers=[];unconstrainedHandler;find(){return this.unconstrainedHandler}add(e){let t={params:e.params,handler:e.handler,createParams:function(e){let t=e.length;return function(r){let s={};for(let i=0;i<t;i++)s[e[i]]=r[i];return s}}(e.params)};this.handlers.push(t),this.unconstrainedHandler=this.handlers[0]}}class tN{isLeafNode=!1;routes;handlerStorage;addRoute(e){void 0===this.routes?this.routes=[e]:this.routes.push(e),void 0===this.handlerStorage&&(this.handlerStorage=new tD),this.isLeafNode=!0,this.handlerStorage.add(e)}}class tE extends tN{staticChildren={};findStaticMatchingChild(e,t){let r=this.staticChildren[e.charAt(t)];if(void 0!==r&&r.matchPrefix(e,t))return r}getStaticChild(e,t=0){if(e.length===t)return this;let r=this.findStaticMatchingChild(e,t);if(void 0!==r)return r.getStaticChild(e,t+r.prefix.length)}createStaticChild(e){if(0===e.length)return this;let t=this.staticChildren[e.charAt(0)];if(t){let r=1;for(;r<t.prefix.length;r++)if(e.charCodeAt(r)!==t.prefix.charCodeAt(r)){t=t.split(this,r);break}return t.createStaticChild(e.slice(r))}let r=e.charAt(0);return this.staticChildren[r]=new tP(e),this.staticChildren[r]}}class tP extends tE{_tag="StaticNode";constructor(e){super(),this.setPrefix(e)}prefix;matchPrefix;parametricChildren=[];wildcardChild;setPrefix(e){if(this.prefix=e,1===e.length)this.matchPrefix=(e,t)=>!0;else{let t=e.length;this.matchPrefix=function(e,r){for(let s=1;s<t;s++)if(e.charCodeAt(r+s)!==this.prefix.charCodeAt(s))return!1;return!0}}}getParametricChild(e){if(void 0===e)return this.parametricChildren.find(e=>!1===e.isRegex);let t=e.source;return this.parametricChildren.find(e=>void 0!==e.regex&&e.regex.source===t)}createParametricChild(e,t,r){let s=this.getParametricChild(e);return void 0!==s?s.nodePaths.add(r):(s=new tF(e,t,r),this.parametricChildren.push(s),this.parametricChildren.sort((e,t)=>e.isRegex?t.isRegex?void 0===e.staticSuffix?1:void 0===t.staticSuffix?-1:t.staticSuffix.endsWith(e.staticSuffix)?1:e.staticSuffix.endsWith(t.staticSuffix)?-1:0:-1:1)),s}createWildcardChild(){return void 0===this.wildcardChild&&(this.wildcardChild=new tO),this.wildcardChild}split(e,t){let r=this.prefix.slice(0,t),s=this.prefix.slice(t);this.setPrefix(s);let i=new tP(r);return i.staticChildren[s.charAt(0)]=this,e.staticChildren[r.charAt(0)]=i,i}getNextNode(e,t,r,s){let i=this.findStaticMatchingChild(e,t),a=0;if(void 0===i){if(0===this.parametricChildren.length)return this.wildcardChild;i=this.parametricChildren[0],a=1}void 0!==this.wildcardChild&&r.push({paramsCount:s,brotherPathIndex:t,brotherNode:this.wildcardChild});for(let e=this.parametricChildren.length-1;e>=a;e--)r.push({paramsCount:s,brotherPathIndex:t,brotherNode:this.parametricChildren[e]});return i}}class tF extends tE{regex;staticSuffix;_tag="ParametricNode";constructor(e,t,r){super(),this.regex=e,this.staticSuffix=t,this.isRegex=!!e,this.nodePaths=new Set([r])}isRegex;nodePaths;getNextNode(e,t){return this.findStaticMatchingChild(e,t)}}class tO extends tN{_tag="WildcardNode";getNextNode(e,t,r,s){}}let tU=(e,t)=>{if(!e)throw Error(t)};function tM(e){return e.replace(/\/\/+/g,"/")}function tz(e){return e.length>1&&47===e.charCodeAt(e.length-1)?e.slice(0,-1):e}function t$(e,t){return 50===e?53===t?"%":51===t?"#":52===t?"$":54===t?"&":66===t||98===t?"+":67===t||99===t?",":70===t||102===t?"/":void 0:51===e?65===t||97===t?":":66===t||98===t?";":68===t||100===t?"=":70===t||102===t?"?":void 0:52===e&&48===t?"@":void 0}function tq(e){let t=e.indexOf("%");if(-1===t)return e;let r="",s=t;for(let i=t;i<e.length;i++)if(37===e.charCodeAt(i)){let t=t$(e.charCodeAt(i+1),e.charCodeAt(i+2));r+=e.slice(s,i)+t,s=i+3}return e.slice(0,t)+r+e.slice(s)}let tL=["ACL","BIND","CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LINK","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REBIND","REPORT","SEARCH","SOURCE","SUBSCRIBE","TRACE","UNBIND","UNLINK","UNLOCK","UNSUBSCRIBE"],tj=(e={})=>new tA(e),tB=Symbol.for("@effect/platform/HttpRouter"),tH=Symbol.for("@effect/platform/HttpRouter/Route"),tV=Symbol.for("@effect/platform/HttpRouter/RouteContext"),tJ=f.Io("@effect/platform/HttpRouter/RouteContext"),tY=e=>x.i5(e,tB),tQ=(0,H.V)("@effect/platform/HttpRouter/currentRouterConfig",()=>el.p5({}));class tW extends C.av{constructor(e,t){super(),this.routes=e,this.mounts=t,this[tB]=tB,this.httpApp=el.Jt(tQ).pipe(h.qIB(e=>this.httpApp=tX(this,e)))}commit(){return this.httpApp}toJSON(){return{_id:"Router",routes:this.routes.toJSON(),mounts:this.mounts.toJSON()}}toString(){return w.GP(this)}[w.FX](){return this.toJSON()}}let tX=(e,t)=>{let r=tj(t),s=ea.h3(e.mounts).map(([e,t,r])=>[e,new tZ(new tG("*",r?.includePrefix?`${e}/*`:"/*",t,r?.includePrefix?T.dv():T.zN(e),!1),{}),r]),i=s.length;return ea.jJ(e.routes,e=>{"*"===e.method?r.all(e.path,e):r.on(e.method,e.path,e)}),h.$we(e=>{let t=f.$N(new Map(e.getFiberRef(el.Fi).unsafeMap)),a=f.$v(t,tn);if(i>0)for(let e=0;e<i;e++){let[r,i,n]=s[e];if(a.url.startsWith(r))return t.unsafeMap.set(tJ.key,i),n?.includePrefix!==!0&&t.unsafeMap.set(tn.key,tK(a,r)),h.Lmr(h.qIB(i.route.handler,L),el.Fi,t)}let n=r.find(a.method,a.url);if(void 0===n&&"HEAD"===a.method&&(n=r.find("GET",a.url)),void 0===n)return h.fJG(new Z({request:a}));let l=n.handler;"Some"===l.prefix._tag&&t.unsafeMap.set(tn.key,tK(a,l.prefix.value)),t.unsafeMap.set(tl.key,n.searchParams),t.unsafeMap.set(tJ.key,new tZ(l,n.params));let o=f.om(t,tw.Tv);"Some"===o._tag&&"Span"===o.value._tag&&o.value.attribute("http.route",l.path);let u=h.qIB(l.handler,L);return h.Lmr(l.uninterruptible?u:h.Inz(u),el.Fi,t)})};function tK(e,t){let r=t.length;return e.modify({url:e.url.length<=r?"/":e.url.slice(r)})}class tG extends w.Xs{constructor(e,t,r,s=T.dv(),i=!1){super(),this.method=e,this.path=t,this.handler=r,this.prefix=s,this.uninterruptible=i,this[tH]=tH}toJSON(){return{_id:"@effect/platform/HttpRouter/Route",method:this.method,path:this.path,prefix:this.prefix.toJSON()}}}class tZ{constructor(e,t){this.route=e,this.params=t,this[tV]=tV}}let t1=new tW(ea.Ie(),ea.Ie()),t0=e=>e.endsWith("/")?e.slice(0,-1):e,t4=((e,t)=>(t=t0(t),new tW(ea.Tj(e.routes,e=>new tG(e.method,"/"===e.path?t:t+e.path,e.handler,T.NW(T.Tj(e.prefix,e=>t+e),()=>T.zN(t)),e.uninterruptible)),ea.Tj(e.mounts,([e,r])=>["/"===e?t:t+e,r]))),e=>(0,g.XY)(e=>tY(e[0]),(t,r,s,i)=>new tW(ea.BC(t.routes,new tG(e,r,s,T.dv(),i?.uninterruptible??!1)),t.mounts))),t2=t4("GET"),t5=t4("POST"),t7=(0,g.XY)(2,(e,t)=>new tW(ea.Tj(e.routes,e=>new tG(e.method,e.path,t(h.qIB(e.handler,L)),e.prefix,e.uninterruptible)),ea.Tj(e.mounts,([e,r])=>[e,t(r)]))),t8=((e,t)=>new tW(ea.Tj(e.routes,e=>new tG(e.method,e.path,t(e.handler),e.prefix,e.uninterruptible)),ea.Tj(e.mounts,([e,r])=>[e,h.qIB(t(r),L)])),(e,t)=>{let r=es.lNp(e,t);return h.qIB(h._OA(),e=>{let t=f.Jt(e,tl),s=f.Jt(e,tJ);return r({...t,...s.params})})});var t3=r(85936),t6=r(85375),t9=r(11913);t9.ii,t9.tO,t9.CM,t9.XL;let re=t9.Td;t9.Ge,t9.ti,t9.p$,R.ii,R.gT,R.hQ,R.Ie,R.lS,R.wF;let rt=R.Qq;R.jz,R.Pq,R.Og,R._S,R.ZN,R.Td,R.NJ,R.XE,R.P8;var rr=r(78771),rs=r(5758);let ri=Symbol.for("@effect/matcher/Matcher"),ra={[ri]:{_input:g.D_,_filters:g.D_,_remaining:g.D_,_result:g.D_,_return:g.D_},_tag:"TypeMatcher",add(e){return function(e){let t=Object.create(ra);return t.cases=e,t}([...this.cases,e])},pipe(){return(0,eh.t)(this,arguments)}},rn={[ri]:{_input:g.D_,_filters:g.D_,_result:g.D_,_return:g.D_},_tag:"ValueMatcher",add(e){return"Right"===this.value._tag?this:"When"===e._tag&&!0===e.guard(this.provided)?rl(this.provided,rs.pG(e.evaluate(this.provided))):"Not"===e._tag&&!1===e.guard(this.provided)?rl(this.provided,rs.pG(e.evaluate(this.provided))):this},pipe(){return(0,eh.t)(this,arguments)}};function rl(e,t){let r=Object.create(rn);return r.provided=e,r.value=t,r}let ro=(e,t)=>({_tag:"When",guard:e,evaluate:t}),ru=e=>{if("function"==typeof e)return e;if(Array.isArray(e)){let t=e.map(ru),r=t.length;return e=>{if(!Array.isArray(e))return!1;for(let s=0;s<r;s++)if(!1===t[s](e[s]))return!1;return!0}}if(null!==e&&"object"==typeof e){let t=Object.entries(e).map(([e,t])=>[e,ru(t)]),r=t.length;return e=>{if("object"!=typeof e||null===e)return!1;for(let s=0;s<r;s++){let[r,i]=t[s];if(!(r in e)||!1===i(e[r]))return!1}return!0}}return t=>t===e},rh=e=>{if("ValueMatcher"===e._tag)return e.value;let t=e.cases.length;if(1===t){let t=e.cases[0];return e=>"When"===t._tag&&!0===t.guard(e)?rs.pG(t.evaluate(e)):"Not"===t._tag&&!1===t.guard(e)?rs.pG(t.evaluate(e)):rs.kb(e)}return r=>{for(let s=0;s<t;s++){let t=e.cases[s];if("When"===t._tag&&!0===t.guard(r)||"Not"===t._tag&&!1===t.guard(r))return rs.pG(t.evaluate(r))}return rs.kb(r)}},rd=e=>rl(e,rs.kb(e)),rc=(e,t)=>r=>r.add(ro(ru(e),t));x.Kg,x.Et,x.Lm,x.b0,x.kZ,x.sI,x.Bm,x.$P,x.u4;let rf=e=>t=>{let r=rh(t);return rs.Wc(r)?"Right"===r._tag?r.right:e(r.left):t=>{let s=r(t);return"Right"===s._tag?s.right:e(s.left)}};var rp=r(10711),rg=r(26569),rm=r(42240),ry=r(14781),rv=r(84339),rk=r(20171),rx=r(46184);let rC=Symbol("uploadthing-custom-id-symbol");var rw="7.4.4";es.uSQ(...rg.wq),es.uSQ(...rg.Wc);let rS=es.uSQ("upload"),rb=es.uSQ("callback","error"),rT=es.pdi(es.Wvx,es.QfV,{decode:e=>new TextDecoder().decode(e),encode:e=>new TextEncoder().encode(e)}),rI=es._kM({apiKey:es.tmY(es.QfV.pipe(es.w1_("sk_"))),appId:es.QfV,regions:es.eXb(es.QfV),ingestHost:es.QfV.pipe(es.ZEe({default:()=>"ingest.uploadthing.com"}))}),r_=es.zkt.pipe(es.ZzX(rT),es.ZzX(es.qFJ(rI)));class rR extends es.Xsx("FileUploadData")({name:es.QfV,size:es.wNn,type:es.QfV,lastModified:es.wNn.pipe(es.lqM)}){}class rA extends rR.extend("FileUploadDataWithCustomId")({customId:es.T9y(es.QfV)}){}class rD extends rA.extend("UploadedFileData")({key:es.QfV,url:es.QfV,appUrl:es.QfV,fileHash:es.QfV}){}class rN extends es.Xsx("MetadataFetchStreamPart")({payload:es.QfV,signature:es.QfV,hook:rb}){}class rE extends es.Xsx("MetadataFetchResponse")({ok:es.v8c}){}class rP extends es.Xsx("CallbackResultResponse")({ok:es.v8c}){}class rF extends es.Xsx("UploadActionPayload")({files:es.O31(rR),input:es.$r1}){}let rO=rm.sF().pipe(rm.NW(()=>rm.xY(new Map(Object.entries((0,rg.DF)({}))),{pathDelim:"_"})),rm.cY("uploadthing"),rm.FU),rU=e=>rm.Rf(e??{}).pipe(rm.NW(()=>rO)),rM=rr.zM("isDev").pipe(rr.NW(()=>rr.Py("undefined"!=typeof process?"production":void 0).pipe(rr.Tj(e=>"development"===e))),rr.IQ(!1)),rz=es.TSw("token",r_).pipe(h.loE({ConfigError:e=>new rg.SD({code:"InvalidData"===e._op?"INVALID_SERVER_CONFIG":"MISSING_ENV",message:"InvalidData"===e._op?"Invalid token. A token is a base64 encoded JSON object matching { apiKey: string, appId: string, regions: string[] }.":"Missing token. Please set the `UPLOADTHING_TOKEN` environment variable or provide a token manually through config.",cause:e})}));rr.Yj("apiUrl").pipe(rr.IQ("https://api.uploadthing.com"),rr.IY(e=>new URL(e)),rr.Tj(e=>e.href.replace(/\/$/,"")));let r$=h.JkU(function*(){let{regions:e,ingestHost:t}=yield*rz,r=e[0];return yield*rr.Yj("ingestUrl").pipe(rr.IQ(`https://${r}.${t}`),rr.IY(e=>new URL(e)),rr.Tj(e=>e.href.replace(/\/$/,"")))});function rq(e){return{message:e.message}}function rL(e,t){return(t[Object.keys(t)[0]]?.errorFormatter??rq)(e)}let rj=(e,t)=>r=>{let s="";return r.pipe(S.g7H(),S.WK$(e=>h.JkU(function*(){let t=(s+=e).split("\n"),r=[];for(let e of t)try{r.push(JSON.parse(e)),s=s.slice(e.length+1)}catch{}return yield*h.MDB("Received chunks").pipe(h.swY("chunk",e),h.swY("parsedChunks",r),h.swY("buf",s)),r})),S.WK$(es.lNp(es.O31(e))),S.WK$(h.jJl(e=>t(e))),S.KEl,h.f1X("handleJsonLineStream"))},rB=rr.dm("logLevel").pipe(rr.IQ(rv.R2),h.hgn(e=>ry.minimumLogLevel(e)),h.sFT(e=>h.vVN("Invalid log level").pipe(h.swY("error",e))),h.KuX("ConfigError",e=>new rg.SD({code:"INVALID_SERVER_CONFIG",message:"Invalid server configuration",cause:e})),ej.vM),rH=rr.eu("json","logFmt","structured","pretty")("logFormat"),rV=h.JkU(function*(){let e=yield*rM;return ry[yield*rH.pipe(rr.IQ(e?"pretty":"json"))]}).pipe(h.KuX("ConfigError",e=>new rg.SD({code:"INVALID_SERVER_CONFIG",message:"Invalid server configuration",cause:e})),ej.vM),rJ=(e,t)=>{let r=t?.mixin??"json",s=rv.Al(t?.level??"Debug");return t=>h.qIB("None"!==r?t[r]:h.rIH,()=>h.lIX(s,`${e} (${t.status})`).pipe(h.swY("response",t)))},rY=e=>t=>"ResponseError"===t._tag?rJ(e,{level:"Error"})(t.response):h.vVN(e).pipe(h.swY("error",t));class rQ extends rk.rN("ParserError"){constructor(...e){super(...e),this.message="Input validation failed. The original error with it's validation issues is in the error cause."}}class rW extends rk.$D{constructor(e,t,r){super({reason:`You uploaded a ${e} file that was ${(0,rg.YQ)(r)}, but the limit for that type is ${t}`}),this._tag="FileSizeMismatch",this.name="FileSizeMismatchError"}}class rX extends rk.$D{constructor(e,t,r,s){super({reason:`You uploaded ${s} file(s) of type '${e}', but the ${t} for that type is ${r}`}),this._tag="FileCountMismatch",this.name="FileCountMismatchError"}}let rK=(e,t)=>h.JkU(function*(){let r={};for(let s of e){let e=yield*(0,rg.MB)(s,(0,rg.uv)(t));r[e]=(r[e]??0)+1;let i=t[e]?.maxFileSize;if(!i)return yield*new rg.rc(e,"maxFileSize");let a=yield*(0,rg.el)(i);if(s.size>a)return yield*new rW(e,i,s.size)}for(let e in r){let s=t[e];if(!s)return yield*new rg.rc(e);let i=r[e],a=s.minFileCount,n=s.maxFileCount;if(a>n)return yield*new rg.SD({code:"BAD_REQUEST",message:"Invalid config during file count - minFileCount > maxFileCount",cause:`minFileCount must be less than maxFileCount for key ${e}. got: ${a} > ${n}`});if(i<a)return yield*new rX(e,"minimum",a,i);if(i>n)return yield*new rX(e,"maximum",n,i)}return null}),rG=e=>h.jJl((0,rg.uv)(e),t=>h.TjK((0,rg.V3)(e[t].routerConfig),e=>({slug:t,config:e}))),rZ=(e,t)=>{let r=ej.S5(d.qd,ej.Py(d.Fp,e)),s=ej.kC(el.yo(c.Oj,e=>e.concat(["x-uploadthing-api-key"]))),i=ej.Gt(ej.Um(rV,rB,r,s),ej.e2(rU(t)));return rx.L8(i)};class r1 extends f.vw("uploadthing/AdapterArguments")(){}let r0=(e,t,r,s)=>{let i=rZ(r.config?.fetch,r.config),a=h.ivC(()=>i.runtime().then(tC)),n=(...t)=>h.TjK(h.ivC(()=>i.runPromise(r4(r,s))),h.c7E(r1,e(...t)));return async(...e)=>await a.pipe(h.ap(n(...e)),h.ap(t(...e)),h.f1X("requestHandler"),i.runPromise)},r4=(e,t)=>h.JkU(function*(){let r=yield*rM,s=yield*rG(e.router),i=e.config?.handleDaemonPromise?e.config.handleDaemonPromise:r?"void":"await";if(r&&"await"===i)return yield*new rg.SD({code:"INVALID_SERVER_CONFIG",message:'handleDaemonPromise: "await" is forbidden in development.'});let a=h.JkU(function*(){return yield*O(s)}),n=h.JkU(function*(){let{"uploadthing-hook":r,"x-uploadthing-package":s,"x-uploadthing-version":a}=yield*th(es._kM({"uploadthing-hook":rb.pipe(es.lqM),"x-uploadthing-package":es.QfV.pipe(es.ZEe({default:()=>"unknown"})),"x-uploadthing-version":es.QfV.pipe(es.ZEe({default:()=>rw}))}));a!==rw&&(yield*h.FFw("Client version mismatch. Things may not work as expected, please sync your versions to ensure compatibility.").pipe(h.swY({clientVersion:a,serverVersion:rw})));let{slug:n,actionType:l}=yield*t8(es._kM({actionType:rS.pipe(es.lqM),slug:es.QfV})),o=e.router[n];if(!o){let e=`No file route found for slug ${n}`;return yield*h.vVN(e),yield*new rg.SD({code:"NOT_FOUND",message:e})}let{body:u,fiber:d}=yield*rd({actionType:l,uploadthingHook:r}).pipe(rc({actionType:"upload",uploadthingHook:void 0},()=>r8({uploadable:o,fePackage:s,beAdapter:t,slug:n})),rc({actionType:void 0,uploadthingHook:"callback"},()=>r5({uploadable:o,fePackage:s,beAdapter:t})),rc({actionType:void 0,uploadthingHook:"error"},()=>r2({uploadable:o})),rf(()=>h.PyW({body:null,fiber:null})));return d&&(yield*h.MDB("Running fiber as daemon").pipe(h.swY("handleDaemon",i)),"void"===i||("await"===i?yield*d.await:"function"==typeof i&&i(h.pR5(d.await)))),yield*h.MDB("Sending response").pipe(h.swY("body",u)),yield*O(u)}).pipe(h.loE({ParseError:t=>O(rL(new rg.SD({code:"BAD_REQUEST",message:"Invalid input",cause:t.message}),e.router),{status:400}),UploadThingError:t=>O(rL(t,e.router),{status:(0,rg.Cv)(t)})})),l=h.TjK(F("x-uploadthing-version",rw));return t1.pipe(t2("*",a),t5("*",n),t7(l))}).pipe(h.f1X("createRequestHandler")),r2=e=>h.JkU(function*(){let{uploadable:t}=e,r=yield*tn,{apiKey:s}=yield*rz,i=yield*(0,rg.Od)((yield*r.text),r.headers["x-uploadthing-signature"],s);if(yield*h.MDB(`Signature verified: ${i}`),!i)return yield*h.vVN("Invalid signature"),yield*new rg.SD({code:"BAD_REQUEST",message:"Invalid signature"});let a=yield*td(es._kM({fileKey:es.QfV,error:es.QfV}));yield*h.MDB("Handling error callback request with input:").pipe(h.swY("json",a));let n=yield*r1;return{body:null,fiber:yield*h.$mh({try:async()=>t.onUploadError({...n,error:new rg.SD({code:"UPLOAD_FAILED",message:`Upload failed for ${a.fileKey}: ${a.error}`}),fileKey:a.fileKey}),catch:e=>new rg.SD({code:"INTERNAL_SERVER_ERROR",message:"Failed to run onUploadError",cause:e})}).pipe(h.sFT(e=>h.vVN("Failed to run onUploadError. You probably shouldn't be throwing errors here.").pipe(h.swY("error",e)))).pipe(h.XPT,h.LXu)}}).pipe(h.f1X("handleErrorRequest")),r5=e=>h.JkU(function*(){let{uploadable:t,fePackage:r,beAdapter:s}=e,i=yield*tn,{apiKey:a}=yield*rz,n=yield*(0,rg.Od)((yield*i.text),i.headers["x-uploadthing-signature"],a);if(yield*h.MDB(`Signature verified: ${n}`),!n)return yield*h.vVN("Invalid signature"),yield*new rg.SD({code:"BAD_REQUEST",message:"Invalid signature"});let l=yield*td(es._kM({status:es.QfV,file:rD,metadata:es.mSG({key:es.QfV,value:es.$r1})}));return yield*h.MDB("Handling callback request with input:").pipe(h.swY("json",l)),{body:null,fiber:yield*h.JkU(function*(){let e=yield*r1,i=yield*h.$mh({try:async()=>t.onUploadComplete({...e,file:l.file,metadata:l.metadata}),catch:e=>new rg.SD({code:"INTERNAL_SERVER_ERROR",message:"Failed to run onUploadComplete. You probably shouldn't be throwing errors here.",cause:e})}),n={fileKey:l.file.key,callbackData:i??null};yield*h.MDB("'onUploadComplete' callback finished. Sending response to UploadThing:").pipe(h.swY("callbackData",n));let o=yield*r$,u=(yield*t3.Qq).pipe(t3.p$);yield*t6.bE("/callback-result").pipe(t6.c5(o),t6.lL({"x-uploadthing-api-key":rp.Uq(a),"x-uploadthing-version":rw,"x-uploadthing-be-adapter":s,"x-uploadthing-fe-package":r}),t6.zW(n),h.qIB(u.execute),h.sFT(rY("Failed to register callback result")),h.qIB(ei._u(rP)),h.Mim(h.Rm2("Sent callback result to UploadThing")),h.P1j)}).pipe(h.XPT,h.LXu)}}).pipe(h.f1X("handleCallbackRequest")),r7=e=>h.JkU(function*(){let{json:{files:t,input:r},uploadable:s}=e;yield*h.MDB("Running middleware");let i=yield*r1,a=yield*h.$mh({try:async()=>s.middleware({...i,input:r,files:t}),catch:e=>e instanceof rg.SD?e:new rg.SD({code:"INTERNAL_SERVER_ERROR",message:"Failed to run middleware",cause:e})});if(a[rC]&&a[rC].length!==t.length){let e=`Expected files override to have the same length as original files, got ${a[rC].length} but expected ${t.length}`;return yield*h.vVN(e),yield*new rg.SD({code:"BAD_REQUEST",message:"Files override must have the same length as files",cause:e})}let n=yield*h.jJl(t,(e,t)=>h.JkU(function*(){let r=a[rC]?.[t];return r&&r.size!==e.size&&(yield*h.FFw("File size mismatch. Reverting to original size")),{name:r?.name??e.name,size:e.size,type:e.type,customId:r?.customId,lastModified:r?.lastModified??Date.now()}}));return{metadata:a,filesWithCustomIds:n}}).pipe(h.f1X("runRouteMiddleware")),r8=e=>h.JkU(function*(){let t=(yield*t3.Qq).pipe(t3.p$),{uploadable:r,fePackage:s,beAdapter:i,slug:a}=e,n=yield*td(rF);yield*h.MDB("Handling upload request").pipe(h.swY("json",n)),yield*h.MDB("Parsing user input");let l=yield*h.$mh({try:()=>(function(e){if("~standard"in e)return async t=>{let r=await e["~standard"].validate(t);if(r.issues)throw new rQ({cause:r.issues});return r.value};if("parseAsync"in e&&"function"==typeof e.parseAsync)return e.parseAsync;if(es.Wlq(e))return t=>es.y_2(e)(t).catch(e=>{throw new rQ({cause:v.iw(e[p.VK])})});throw Error("Invalid parser")})(r.inputParser)(n.input),catch:e=>new rg.SD({code:"BAD_REQUEST",message:"Invalid input",cause:e})});yield*h.MDB("Input parsed successfully").pipe(h.swY("input",l));let{metadata:o,filesWithCustomIds:u}=yield*r7({json:{input:l,files:n.files},uploadable:r});yield*h.MDB("Parsing route config").pipe(h.swY("routerConfig",r.routerConfig));let d=yield*(0,rg.V3)(r.routerConfig).pipe(h.KuX("InvalidRouteConfig",e=>new rg.SD({code:"BAD_REQUEST",message:"Invalid route config",cause:e})));yield*h.MDB("Route config parsed successfully").pipe(h.swY("routeConfig",d)),yield*h.MDB("Validating files meet the config requirements").pipe(h.swY("files",n.files)),yield*rK(n.files,d).pipe(h.xm_(e=>new rg.SD({code:"BAD_REQUEST",message:`Invalid config: ${e._tag}`,cause:"reason"in e?e.reason:e.message}))),yield*h.MDB("Files validated.");let c=yield*h.jJl(u,e=>h.TjK((0,rg.MB)(e,(0,rg.uv)(d)),t=>({name:e.name,size:e.size,type:e.type||t,lastModified:e.lastModified,customId:e.customId,contentDisposition:d[t]?.contentDisposition??"inline",acl:d[t]?.acl}))).pipe(h.loE({InvalidFileType:e=>h.F_Q(e),UnknownFileType:e=>h.F_Q(e)})),f=r.routeOptions,{apiKey:g,appId:m}=yield*rz,y=yield*r$,k=yield*rM;yield*h.MDB("Generating presigned URLs").pipe(h.swY("fileUploadRequests",c),h.swY("ingestUrl",y));let x=yield*h.jJl(c,e=>h.JkU(function*(){let t=yield*(0,rg.rh)(e,m,f.getFileHashParts);return{url:yield*(0,rg.xX)(`${y}/${t}`,g,{ttlInSeconds:f.presignedURLTTL,data:{"x-ut-identifier":m,"x-ut-file-name":e.name,"x-ut-file-size":e.size,"x-ut-file-type":e.type,"x-ut-slug":a,"x-ut-custom-id":e.customId,"x-ut-content-disposition":e.contentDisposition,"x-ut-acl":e.acl}}),key:t}}),{concurrency:"unbounded"}),C=yield*tn,w=yield*tf(C),S=yield*rr.Yj("callbackUrl").pipe(rr.IQ(w.origin+w.pathname),h.TjK(e=>t6.bE(e).pipe(t6.Dc("slug",a)))),b=t6.bE("/route-metadata").pipe(t6.c5(y),t6.lL({"x-uploadthing-api-key":rp.Uq(g),"x-uploadthing-version":rw,"x-uploadthing-be-adapter":i,"x-uploadthing-fe-package":s}),t6.zW({fileKeys:x.map(({key:e})=>e),metadata:o,isDev:k,callbackUrl:S.url,callbackSlug:a,awaitServerData:f.awaitServerData??!0}),h.qIB(t.execute)),T=yield*h.if(k,{onTrue:()=>b.pipe(h.Bio({onSuccess:rJ("Registered metadata",{mixin:"None"}),onFailure:rY("Failed to register metadata")}),re,rj(rN,e=>S.pipe(t6.lL({"uploadthing-hook":e.hook,"x-uploadthing-signature":e.signature}),t6.ju(rt(e.payload,"application/json")),t.execute,h.Bio({onSuccess:rJ("Successfully forwarded callback request from dev stream"),onFailure:rY("Failed to forward callback request from dev stream")}),h.swY(e),h.NLW,h.XPT,h.P1j))),onFalse:()=>b.pipe(h.Bio({onSuccess:rJ("Registered metadata"),onFailure:rY("Failed to register metadata")}),h.qIB(ei._u(rE)),h.P1j)}).pipe(h.LXu),I=x.map((e,t)=>({url:e.url,key:e.key,name:c[t].name,customId:c[t].customId??null}));return yield*h.fH4("Sending presigned URLs to client").pipe(h.swY("presignedUrls",I)),{body:I,fiber:T}}).pipe(h.f1X("handleUploadAction"));var r3=r(81342),r6=r(51825);let{GET:r9,POST:se}=(e=>{let t=r0(e=>h.PyW({req:e,res:void 0,event:void 0}),e=>h.PyW(e),e,"nextjs-app");return{POST:t,GET:t}})({router:{imageUploader:(function e(t={}){let r={$types:{},routerConfig:{image:{maxFileSize:"4MB"}},routeOptions:{awaitServerData:!0},inputParser:{parseAsync:()=>Promise.resolve(void 0),_input:void 0,_output:void 0},middleware:()=>({}),onUploadError:()=>{},onUploadComplete:()=>void 0,errorFormatter:t.errorFormatter??rq,...t};return{input:t=>e({...r,inputParser:t}),middleware:t=>e({...r,middleware:t}),onUploadComplete:e=>({...r,onUploadComplete:e}),onUploadError:t=>e({...r,onUploadError:t})}})({routerConfig:{image:{maxFileSize:"4MB",maxFileCount:1}},routeOptions:(void 0)??{},...s}).middleware(async()=>{let e=await (0,r6.getServerSession)(r3.N);if(!e)throw new rg.SD("Unauthorized");return{token:e}}).onUploadComplete(async({file:e})=>({url:e.url,key:e.key,name:e.name}))}}),st=new l.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/uploadthing/route",pathname:"/api/uploadthing",filename:"route",bundlePath:"app/api/uploadthing/route"},resolvedPagePath:"/Users/jahkon/Desktop/Redopia/client/app/api/uploadthing/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:sr,workUnitAsyncStorage:ss,serverHooks:si}=st;function sa(){return(0,u.patchFetch)({workAsyncStorage:sr,workUnitAsyncStorage:ss})}},96487:()=>{},78335:()=>{},40674:(e,t,r)=>{"use strict";r.d(t,{g:()=>s});let s=r(65859).A.create({baseURL:"http://localhost:8080",withCredentials:!0})},81342:(e,t,r)=>{"use strict";r.d(t,{N:()=>i});var s=r(40674);let i={providers:[(0,r(91642).A)({name:"Credentials",credentials:{userId:{label:"User ID",type:"text"}},async authorize(e){let{data:t}=await s.g.get(`/api/user/profile/${e?.userId}`);return JSON.parse(JSON.stringify({email:t.user.email,name:t.user._id}))}})],callbacks:{async session({session:e}){let{data:t}=await s.g.get(`/api/user/profile/${e.user?.name}`);return e.currentUser=t.user,e}},session:{strategy:"jwt"},jwt:{secret:"55f3221f4eb60c13dac3a49c482cdf4e0cfd6fd0ec65aff99728808f19c43056fee04fd20f8ea9a52cadf237e25885bd221a34d7a42fcfbdb61984ffa798c7e1"},secret:process.env.NEXT_AUTH_SECRET}},42706:(e,t,r)=>{"use strict";e.exports=r(44870)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[10,50,524],()=>r(51406));module.exports=s})();